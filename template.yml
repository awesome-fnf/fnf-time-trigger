ROSTemplateFormatVersion: '2015-09-01'
Transform: 'Aliyun::Serverless-2018-04-03'
Resources:
  # FC resources
  fnf-time-trigger:
    Type: 'Aliyun::Serverless::Service'
    Properties:
      Description: fnf-time-trigger
      Policies:
        - AliyunFnFFullAccess

    timer:
      Type: 'Aliyun::Serverless::Function'
      Properties:
        Description: 'function invoked by FC time trigger'
        Handler: timer.handler
        Runtime: python3
        Timeout: 60
        MemorySize: 128
        CodeUri: src/timer.py
      Events:
        trigger:
          Type: Timer
          Properties:
            Payload: '{"flow_name": "fnf-time-trigger-demo", "input": "{\"key\": \"hello world\"}"}'
            CronExpression: "@every 1m"
            Enable: true

    hello:
      Type: 'Aliyun::Serverless::Function'
      Properties:
        Description: 'function invoked by FnF flow'
        Handler: hello.handler
        Runtime: python3
        Timeout: 60
        MemorySize: 128
        CodeUri: src/hello.py

  # FnF flow
  fnf-time-trigger-demo:
    Type: 'Aliyun::Serverless::Flow'
    Properties:
      Description: 'Fnf time trigger demo flow'
      DefinitionUri: flow.yml
      Policies:
        - AliyunFCInvocationAccess